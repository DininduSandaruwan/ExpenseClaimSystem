@page "/claims/list"
@layout MainLayout
@using ExpenseClaimSystem.Application.DTOs
@using ExpenseClaimSystem.Application.Services
@using ExpenseClaimSystem.Domain.Entities
@using Microsoft.FluentUI.AspNetCore.Components
@rendermode InteractiveServer
@inject IExpenseClaimService ClaimService
@inject NavigationManager Nav


<FluentStack Gap="Spacing.Large" Orientation="Orientation.Vertical">
    <FluentText Typo="Typography.H5">Expense Claims</FluentText>

    <!-- Filters -->
    <FluentStack Orientation="Orientation.Horizontal" Gap="Spacing.Medium" Align="Alignment.Center">
        <FluentStack>
            <label>Status</label>
            <select @bind="filter.Status">
                <option value="">All</option>
                <option>Pending</option>
                <option>Approved</option>
                <option>Rejected</option>
                <option>Deleted</option>
            </select>
        </FluentStack>

        <FluentStack>
            <label>Department</label>
            <select @bind="filter.Department">
                <option value="">All</option>
                <option>HR</option>
                <option>Finance</option>
                <option>IT</option>
                <option>Operations</option>
            </select>
        </FluentStack>

        <FluentStack>
            <label>From</label>
            <InputDate @bind-Value="filter.FromDate" />
        </FluentStack>

        <FluentStack>
            <label>To</label>
            <InputDate @bind-Value="filter.ToDate" />
        </FluentStack>

            <div style="align-self:end">
            <FluentButton Appearance="Appearance.Outline" @onclick="LoadClaims">Filter</FluentButton>
        </div>
    </FluentStack>

    <!-- Simple table-like list (unstyled from Bootstrap) -->
    <table style="width:100%; border-collapse:collapse;">
        <thead style="background:#333;color:#fff;">
            <tr>
                <th style="padding:8px;text-align:left">Request No</th>
                <th style="padding:8px;text-align:left">Employee</th>
                <th style="padding:8px;text-align:left">Department</th>
                <th style="padding:8px;text-align:left">Created At</th>
                <th style="padding:8px;text-align:left" width="200">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var claim in claims)
            {
                <tr style="border-bottom:1px solid #e6e6e6;">
                    <td style="padding:8px">@claim.RequestNumber</td>
                    <td style="padding:8px">@claim.EmployeeId</td>
                    <td style="padding:8px">@claim.Department</td>
                    <td style="padding:8px">@claim.CreatedAt.ToString("yyyy-MM-dd")</td>
                    <td style="padding:8px">
                        <FluentButton Appearance="Appearance.Stealth" @onclick="() => ViewClaim(claim)" Style="margin-right:8px;">View</FluentButton>
                        <FluentButton Appearance="Appearance.Outline" @onclick="() => EditClaim(claim.Id)">Edit</FluentButton>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Modal-like details (kept simple) -->
    @if (selectedClaim != null)
    {
        <div style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.5);">
            <div style="background:#fff; padding:20px; width:600px; border-radius:6px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <FluentText Typo="Typography.H6">Claim Details</FluentText>
                    <FluentButton Appearance="Appearance.Stealth" @onclick="CloseModal">✕</FluentButton>
                </div>
                <div>
                    <p><strong>Request No:</strong> @selectedClaim.RequestNumber</p>
                    <p><strong>Employee:</strong> @selectedClaim.EmployeeId</p>
                    <p><strong>Department:</strong> @selectedClaim.Department</p>
                    <p><strong>Created At:</strong> @selectedClaim.CreatedAt</p>
                    <p><strong>Status:</strong> @selectedClaim.Status</p>
                    <p><strong>Total:</strong> @selectedClaim.TotalAmount</p>
                </div>
                <div style="display:flex; justify-content:flex-end; margin-top:12px;">
                    <FluentButton Appearance="Appearance.Stealth" @onclick="CloseModal">Close</FluentButton>
                </div>
            </div>
        </div>
    }

</FluentStack>
@code {
	private List<ExpenseClaim> claims = new();
	private ExpenseClaim? selectedClaim;
	private ExpenseClaimFilterDto filter = new();

	protected override async Task OnInitializedAsync()
	{
		await LoadClaims();
	}

	async Task LoadClaims()
	{
		claims = await ClaimService.GetFilteredAsync(filter);
	}

	void ViewClaim(ExpenseClaim claim)
	{
		selectedClaim = claim;
	}

	void CloseModal()
	{
		selectedClaim = null;
	}

	void EditClaim(Guid id)
	{
		Nav.NavigateTo($"/claims/edit/{id}");
	}


	string GetStatusColor(string status)
	{
		return status switch
		{
			"Approved" => "success",
			"Rejected" => "danger",
			"Pending" => "warning",
			"Deleted" => "secondary",
			_ => "primary"
		};
	}

}
