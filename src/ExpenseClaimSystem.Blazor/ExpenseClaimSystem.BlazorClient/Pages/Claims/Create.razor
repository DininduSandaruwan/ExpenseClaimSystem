@page "/claims/create"
@using ExpenseClaimSystem.Application.DTOs
@using ExpenseClaimSystem.Application.Services
@using ExpenseClaimSystem.Domain.Enums
@inject IExpenseClaimService ClaimService
@inject HttpClient Http

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Tell the browser to be responsive to screen width -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<!-- Favicon icon -->
	<link rel="icon" type="image/png" sizes="16x16" href="src/assets/images/favicon.png">
	<title>Nice admin Template - The Ultimate Multipurpose admin template</title>
	<!-- Custom CSS -->
	<link href="src/dist/css/style.min.css" rel="stylesheet">
</head>
<body>
	<div class="preloader">
		<div class="lds-ripple">
			<div class="lds-pos"></div>
			<div class="lds-pos"></div>
		</div>
	</div>
	<div id="main-wrapper">

		<header class="topbar">
			<nav class="navbar top-navbar navbar-expand-md navbar-dark">
				<div class="navbar-header">
					<!-- This is for the sidebar toggle which is visible on mobile only -->
					<a class="nav-toggler waves-effect waves-light d-block d-md-none" href="javascript:void(0)">
						<i class="ti-menu ti-close"></i>
					</a>
					<!-- ============================================================== -->
					<!-- Logo -->
					<!-- ============================================================== -->
					<div class="navbar-brand">
						<a href="index.html" class="logo">
							<!-- Logo icon -->
							<b class="logo-icon">
								<!--You can put here icon as well // <i class="wi wi-sunset"></i> //-->
								<!-- Dark Logo icon -->
								<img src="src/assets/images/logo-icon.png" alt="homepage" class="dark-logo" />
								<!-- Light Logo icon -->
								<img src="src/assets/images/logo-light-icon.png" alt="homepage" class="light-logo" />
							</b>
							<!--End Logo icon -->
							<!-- Logo text -->
							<span class="logo-text">
								<!-- dark Logo text -->
								<img src="src/assets/images/logo-text.png" alt="homepage" class="dark-logo" />
								<!-- Light Logo text -->
								<img src="src/assets/images/logo-light-text.png" class="light-logo" alt="homepage" />
							</span>
						</a>
						<a class="sidebartoggler d-none d-md-block" href="javascript:void(0)" data-sidebartype="mini-sidebar">
							<i class="mdi mdi-toggle-switch mdi-toggle-switch-off font-20"></i>
						</a>
					</div>
					<!-- ============================================================== -->
					<!-- End Logo -->
					<!-- ============================================================== -->
					<!-- ============================================================== -->
					<!-- Toggle which is visible on mobile only -->
					<!-- ============================================================== -->
					<a class="topbartoggler d-block d-md-none waves-effect waves-light" href="javascript:void(0)" data-toggle="collapse" data-target="#navbarSupportedContent"
					   aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<i class="ti-more"></i>
					</a>
				</div>
				<!-- ============================================================== -->
				<!-- End Logo -->
				<!-- ============================================================== -->
				<div class="navbar-collapse collapse" id="navbarSupportedContent">
					<!-- ============================================================== -->
					<!-- toggle and nav items -->
					<!-- ============================================================== -->
					<ul class="navbar-nav float-left mr-auto">
						<!-- <li class="nav-item d-none d-md-block">
							<a class="nav-link sidebartoggler waves-effect waves-light" href="javascript:void(0)" data-sidebartype="mini-sidebar">
								<i class="mdi mdi-menu font-24"></i>
							</a>
						</li> -->
						<!-- ============================================================== -->
						<!-- Search -->
						<!-- ============================================================== -->
						<li class="nav-item search-box">
							<a class="nav-link waves-effect waves-dark" href="javascript:void(0)">
								<div class="d-flex align-items-center">
									<i class="mdi mdi-magnify font-20 mr-1"></i>
									<div class="ml-1 d-none d-sm-block">
										<span>Search</span>
									</div>
								</div>
							</a>
							<form class="app-search position-absolute">
								<input type="text" class="form-control" placeholder="Search &amp; enter">
								<a class="srh-btn">
									<i class="ti-close"></i>
								</a>
							</form>
						</li>
					</ul>
					<!-- ============================================================== -->
					<!-- Right side toggle and nav items -->
					<!-- ============================================================== -->
					<ul class="navbar-nav float-right">
						<!-- ============================================================== -->
						<!-- Messages -->
						<!-- ============================================================== -->
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle waves-effect waves-dark" href="" id="2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="font-22 mdi mdi-email-outline"></i>

							</a>
							<div class="dropdown-menu dropdown-menu-right mailbox animated bounceInDown" aria-labelledby="2">
								<span class="with-arrow">
									<span class="bg-danger"></span>
								</span>
								<ul class="list-style-none">
									<li>
										<div class="drop-title text-white bg-danger">
											<h4 class="m-b-0 m-t-5">5 New</h4>
											<span class="font-light">Messages</span>
										</div>
									</li>
									<li>
										<div class="message-center message-body">
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="user-img">
													<img src="src/assets/images/users/1.jpg" alt="user" class="rounded-circle">
													<span class="profile-status online pull-right"></span>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Pavan kumar</h5>
													<span class="mail-desc">Just see the my admin!</span>
													<span class="time">9:30 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="user-img">
													<img src="src/assets/images/users/2.jpg" alt="user" class="rounded-circle">
													<span class="profile-status busy pull-right"></span>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Sonu Nigam</h5>
													<span class="mail-desc">I've sung a song! See you at</span>
													<span class="time">9:10 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="user-img">
													<img src="src/assets/images/users/3.jpg" alt="user" class="rounded-circle">
													<span class="profile-status away pull-right"></span>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Arijit Sinh</h5>
													<span class="mail-desc">I am a singer!</span>
													<span class="time">9:08 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="user-img">
													<img src="src/assets/images/users/4.jpg" alt="user" class="rounded-circle">
													<span class="profile-status offline pull-right"></span>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Pavan kumar</h5>
													<span class="mail-desc">Just see the my admin!</span>
													<span class="time">9:02 AM</span>
												</div>
											</a>
										</div>
									</li>
									<li>
										<a class="nav-link text-center link text-dark" href="javascript:void(0);">
											<b>See all e-Mails</b>
											<i class="fa fa-angle-right"></i>
										</a>
									</li>
								</ul>
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- End Messages -->
						<!-- ============================================================== -->
						<!-- ============================================================== -->
						<!-- Comment -->
						<!-- ============================================================== -->
						<li class="nav-item dropdown border-right">
							<a class="nav-link dropdown-toggle waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="mdi mdi-bell-outline font-22"></i>
								<span class="badge badge-pill badge-info noti">3</span>
							</a>
							<div class="dropdown-menu dropdown-menu-right mailbox animated bounceInDown">
								<span class="with-arrow">
									<span class="bg-primary"></span>
								</span>
								<ul class="list-style-none">
									<li>
										<div class="drop-title bg-primary text-white">
											<h4 class="m-b-0 m-t-5">4 New</h4>
											<span class="font-light">Notifications</span>
										</div>
									</li>
									<li>
										<div class="message-center notifications">
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="btn btn-danger btn-circle">
													<i class="fa fa-link"></i>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Luanch Admin</h5>
													<span class="mail-desc">Just see the my new admin!</span>
													<span class="time">9:30 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="btn btn-success btn-circle">
													<i class="ti-calendar"></i>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Event today</h5>
													<span class="mail-desc">Just a reminder that you have event</span>
													<span class="time">9:10 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="btn btn-info btn-circle">
													<i class="ti-settings"></i>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Settings</h5>
													<span class="mail-desc">You can customize this template as you want</span>
													<span class="time">9:08 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="btn btn-primary btn-circle">
													<i class="ti-user"></i>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">Pavan kumar</h5>
													<span class="mail-desc">Just see the my admin!</span>
													<span class="time">9:02 AM</span>
												</div>
											</a>
										</div>
									</li>
									<li>
										<a class="nav-link text-center m-b-5 text-dark" href="javascript:void(0);">
											<strong>Check all notifications</strong>
											<i class="fa fa-angle-right"></i>
										</a>
									</li>
								</ul>
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- End Comment -->
						<!-- ============================================================== -->
						<!-- ============================================================== -->
						<!-- User profile and search -->
						<!-- ============================================================== -->
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle waves-effect waves-dark pro-pic" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<img src="src/assets/images/users/2.jpg" alt="user" class="rounded-circle" width="40">
								<span class="m-l-5 font-medium d-none d-sm-inline-block">Jonathan Doe <i class="mdi mdi-chevron-down"></i></span>
							</a>
							<div class="dropdown-menu dropdown-menu-right user-dd animated flipInY">
								<span class="with-arrow">
									<span class="bg-primary"></span>
								</span>
								<div class="d-flex no-block align-items-center p-15 bg-primary text-white m-b-10">
									<div class="">
										<img src="src/assets/images/users/2.jpg" alt="user" class="rounded-circle" width="60">
									</div>
									<div class="m-l-10">
										<h4 class="m-b-0">Jonathan Doe</h4>
										<p class=" m-b-0">jon@gmail.com</p>
									</div>
								</div>
								<div class="profile-dis scrollable">
									<a class="dropdown-item" href="javascript:void(0)">
										<i class="ti-user m-r-5 m-l-5"></i> My Profile
									</a>
									<a class="dropdown-item" href="javascript:void(0)">
										<i class="ti-wallet m-r-5 m-l-5"></i> My Balance
									</a>
									<a class="dropdown-item" href="javascript:void(0)">
										<i class="ti-email m-r-5 m-l-5"></i> Inbox
									</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="javascript:void(0)">
										<i class="ti-settings m-r-5 m-l-5"></i> Account Setting
									</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="javascript:void(0)">
										<i class="fa fa-power-off m-r-5 m-l-5"></i> Logout
									</a>
									<div class="dropdown-divider"></div>
								</div>
								<div class="p-l-30 p-10">
									<a href="javascript:void(0)" class="btn btn-sm btn-success btn-rounded">View Profile</a>
								</div>
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- User profile and search -->
						<!-- ============================================================== -->
					</ul>
				</div>
			</nav>
		</header>
		<!-- ============================================================== -->
		<!-- End Topbar header -->
		<!-- ============================================================== -->
		<!-- ============================================================== -->
		<!-- Left Sidebar - style you can find in sidebar.scss  -->
		<!-- ============================================================== -->
		<aside class="left-sidebar">
			<!-- Sidebar scroll-->
			<div class="scroll-sidebar">
				<!-- Sidebar navigation-->
				<nav class="sidebar-nav">
					<ul id="sidebarnav">
						<li class="nav-small-cap">
							<i class="mdi mdi-dots-horizontal"></i>
							<span class="hide-menu">Personal</span>
						</li>
						<li class="sidebar-item">
							<a class="sidebar-link waves-effect waves-dark sidebar-link" href="/dashboard" aria-expanded="false">
								<i class="mdi mdi-creation"></i>
								<span class="hide-menu">Dashboard</span>
							</a>
						</li>
						<li class="sidebar-item">
							<a class="sidebar-link has-arrow waves-effect waves-dark" href="javascript:void(0)" aria-expanded="false">
								<i class="mdi mdi-tune"></i>
								<span class="hide-menu">Claims </span>
							</a>
							<ul aria-expanded="false" class="collapse  first-level">
								<li class="sidebar-item">
									<a href="/claims/create" class="sidebar-link">
										<i class="mdi mdi-view-quilt"></i>
										<span class="hide-menu"> Create Claim </span>
									</a>
								</li>
								<li class="sidebar-item">
									<a href="/claims/list" class="sidebar-link">
										<i class="mdi mdi-view-quilt"></i>
										<span class="hide-menu"> Claim List</span>
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</nav>
				<!-- End Sidebar navigation -->
			</div>
			<!-- End Sidebar scroll-->
		</aside>

		<!-- ============================================================== -->
		<!-- End Left Sidebar - style you can find in sidebar.scss  -->
		<!-- ============================================================== -->
		<!-- ============================================================== -->
		<!-- Page wrapper  -->
		<!-- ============================================================== -->
		<div class="page-wrapper">
			<!-- ============================================================== -->
			<!-- Bread crumb and right sidebar toggle -->
			<!-- ============================================================== -->
			<div class="page-breadcrumb">
				<div class="row">
					<div class="col-5 align-self-center">
					</div>
					<div class="col-7 align-self-center">
						<div class="d-flex align-items-center justify-content-end">
							<nav aria-label="breadcrumb">
								<ol class="breadcrumb">
									<li class="breadcrumb-item">
										<a href="#">Create Expense Claim</a>
									</li>
								</ol>
							</nav>
						</div>
					</div>
				</div>
			</div>
<h3>Create Expense Claim</h3>

<EditForm Model="model" OnValidSubmit="HandleSubmit" FormName="CreateExpenseClaimForm">
	<DataAnnotationsValidator />

	<div>
		<label>Department</label>
		<InputText @bind-Value="model.Department" />
	</div>


	<div>
		<h5>Expense Detils</h5>
		<hr />
		@* Dropdown - Currency*@
		<select class="form-select">
			<option value="">Select Currency</option>
			@foreach (var currency in Currencies)
			{
				<option value="@currency.Id">@currency.Name</option>
			}
		</select>

		@* Dropdown - Expense Category*@
		<select class="form-select">
			<option value="">Select Expense Category</option>
			@foreach (var category in ExpCategories)
			{
				<option value="@category.Id">@category.Name</option>
			}
		</select>

		<label>Description</label>
		<InputText @bind-Value="model.Description" />

		<label>Amount</label>
		<InputNumber @bind-Value="model.Amount" />

		<button type="button" @onclick="AddItem">Add Item</button>


		@foreach (var item in model.Items)
		{
			<div class="expense-row">
				<select class="form-select" @bind="item.Category">
					<option value="">Select Category</option>
					@foreach (var category in ExpCategories)
					{
						<option value="@category.Name">@category.Name</option>
					}
				</select>

				<InputText placeholder="Description" @bind-Value="item.Description" />
				<InputNumber @bind-Value="item.Amount" />
				<InputCheckbox @bind-Value="item.IsGstApplicable" />

				<button type="button" @onclick="() => RemoveItem(item)">
					Remove
				</button>
			</div>
		}
		<hr />

	</div>

	<div>
		<h5>Attchements</h5>
		<hr />
		@* Dropdown - Attachement Types*@
		<select class="form-select">
			<option value="">Select Attachement Type</option>
			@foreach (var attachement in AttachementTypes)
			{
				<option value="@attachement.Id">@attachement.Name</option>
			}
		</select>
	</div>
	<InputFile OnChange="HandleFileUpload" />

	<div>

		<h5>Payment Method Details</h5>
		<hr />
		<InputRadioGroup @bind-Value="model.PaymentMethod">
			<InputRadio Value="PaymentMethod.Cash" /> Cash
			<InputRadio Value="PaymentMethod.Card" /> Card
		</InputRadioGroup>
	</div>

	@if (model.PaymentMethod == PaymentMethod.Card)
	{
		<div>
			<InputText placeholder="Bank Code" @bind-Value="model.BankNameCode" />
			<InputText placeholder="Account Name" @bind-Value="model.AccountName" />
			<InputText placeholder="Account Number" @bind-Value="model.AccountNumber" />
		</div>
	}

	<button type="submit">Submit</button>
</EditForm>

			<!-- ============================================================== -->
			<!-- End Container fluid  -->
			<!-- ============================================================== -->
			<!-- ============================================================== -->
			<!-- footer -->
			<!-- ============================================================== -->
			<footer class="footer text-center">
				All Rights Reserved by Fan Wiki. Designed and Developed by
				<a href="https://nerdwareinnovations.com">Nerdware Innovations</a>.
			</footer>
			<!-- ============================================================== -->
			<!-- End footer -->
			<!-- ============================================================== -->
		</div>
		<!-- ============================================================== -->
		<!-- End Page wrapper  -->
		<!-- ============================================================== -->
	</div>
	<!-- ============================================================== -->
	<!-- End Wrapper -->
	<!-- ============================================================== -->
	<!-- ============================================================== -->
	<!-- All Jquery -->
	<!-- ============================================================== -->
	<script src="src/assets/libs/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap tether Core JavaScript -->
	<script src="src/assets/libs/popper.js/dist/umd/popper.min.js"></script>
	<script src="src/assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
	<!-- apps -->
	<script src="src/dist/js/app.min.js"></script>
	<script src="src/dist/js/app.init.dark.js"></script>
	<script src="src/dist/js/app-style-switcher.js"></script>
	<!-- slimscrollbar scrollbar JavaScript -->
	<script src="src/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
	<script src="src/assets/extra-libs/sparkline/sparkline.js"></script>
	<!--Wave Effects -->
	<script src="src/dist/js/waves.js"></script>
	<!--Menu sidebar -->
	<script src="src/dist/js/sidebarmenu.js"></script>
	<!--Custom JavaScript -->
	<script src="src/dist/js/custom.js"></script>
	<!--This page JavaScript -->
	<!--c3 charts -->
	<script src="src/assets/extra-libs/c3/d3.min.js"></script>
	<script src="src/assets/extra-libs/c3/c3.min.js"></script>
</body>
@code {

	private List<IBrowserFile> uploadedFiles = new();

	private async Task HandleFileUpload(InputFileChangeEventArgs e)
	{
		foreach (var file in e.GetMultipleFiles())
		{
			var content = new MultipartFormDataContent();
			var fileContent = new StreamContent(file.OpenReadStream(10_000_000));
			content.Add(fileContent, "file", file.Name);

			var response = await Http.PostAsync("api/attachments", content);

			if (response.IsSuccessStatusCode)
			{
				var result = await response.Content.ReadFromJsonAsync<UploadResult>();

				// store result.filePath in your model
			}
		}
	}

	public class UploadResult
	{
		public string FileName { get; set; }
		public string FilePath { get; set; }
	}

	CreateExpenseClaimDto model = new();

	void AddItem()
	{
		model.Items.Add(new ExpenseItemDto());
	}

	void RemoveItem(ExpenseItemDto item)
	{
		model.Items.Remove(item);
	}

	async Task HandleSubmit()
	{
		// await Http.PostAsJsonAsync("api/ExpenseClaims", model);

		await ClaimService.CreateAsync(model, "user");

		// Optional: navigate to list page
		// NavigationManager.NavigateTo("/claims");
	}

	private List<Crurency> Currencies = new List<Crurency>
	{
		new Crurency { Id = "LKR", Name = "LKR" },
		new Crurency { Id = "USD", Name = "USD" },
		new Crurency { Id = "MVR", Name = "MVR" }
	};

	public class Crurency
	{
		public string Id { get; set; }
		public string Name { get; set; }
	}

	private List<ExpCategory> ExpCategories = new List<ExpCategory>
	{
		new ExpCategory { Id = "1", Name = "Trnsport" },
		new ExpCategory { Id = "2", Name = "Meals" },
		new ExpCategory { Id = "3", Name = "Utility" }
	};

	public class ExpCategory
	{
		public string Id { get; set; }
		public string Name { get; set; }
	}

	private List<AttachementType> AttachementTypes = new List<AttachementType>
	{
		new AttachementType { Id = "1", Name = "Trnsport Bill" },
		new AttachementType { Id = "2", Name = "Meals Bill" },
		new AttachementType { Id = "3", Name = "Utility Bill" }
	};

	public class AttachementType
	{
		public string Id { get; set; }
		public string Name { get; set; }
	}
}
